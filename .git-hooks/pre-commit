#!/bin/bash
# .git/hooks/pre-commit

# Pre-commit hook to run Ruff and Ty in a subdirectory

# --- Configuration ---
# Set your subdirectory here
SUBDIR="memory_agents"

# --- Run Ruff ---
echo "Running Ruff on $SUBDIR..."
uv run ruff format "$SUBDIR"
uv run ruff check --fix "$SUBDIR"
RUFF_STATUS=$?

# --- Run Ty ---
echo "Running Ty on $SUBDIR..."
uv run ty check "$SUBDIR" -c "$SUBDIR"/pyproject.toml
TY_STATUS=$?

# --- Check results ---
if [ $RUFF_STATUS -ne 0 ] || [ $TY_STATUS -ne 0 ]; then
    echo ""
    echo "ðŸš« Commit aborted due to lint/type errors."
    if [ $RUFF_STATUS -ne 0 ]; then
        echo "- Ruff failed."
    fi
    if [ $TY_STATUS -ne 0 ]; then
        echo "- Ty failed."
    fi
    exit 1
fi

echo "âœ… All checks passed."
exit 0

